<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Learning Advanced Javascript</title>
  <meta name="description" content="- Web - iOS - .NET - me - there must be something you like">
  <meta name="author" content="崔家维">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="J-I-A-W-E-I">
  <meta name="twitter:description" content="- Web - iOS - .NET - me - there must be something you like">

  <meta property="og:type" content="article">
  <meta property="og:title" content="J-I-A-W-E-I">
  <meta property="og:description" content="- Web - iOS - .NET - me - there must be something you like">

  <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="shortcut icon" href="/images/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://localhost:4000//2017/Learning-Advanced-Javascript/">
  <link rel="alternate" type="application/rss+xml" title="J-I-A-W-E-I" href="/feed.xml">
</head>


  <body>
    <span class="mobile btn-mobile-menu">
  <i class="icon icon-list btn-mobile-menu__icon"></i>
  <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
</span>
  
<header class="panel-cover" style="background-image: url(/images/cover.jpg)">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <a href="/" title="link to home of J-I-A-W-E-I">
          <img src="/images/profile.jpg" class="user-image" alt="My Profile Photo">
          <h1 class="panel-cover__title panel-title">J-I-A-W-E-I</h1>
        </a>
        <hr class="panel-cover__divider">
        <p class="panel-cover__description">- Web - iOS - .NET - me - there must be something you like</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="link to J-I-A-W-E-I blog" class="blog-button">Blog</a></li>
            </ul>
          </nav>

          <nav class="cover-navigation navigation--social">
            <ul class="navigation">
          
            

            
              <!-- Facebook -->
              <li class="navigation__item">
                <a href="http://fb.me/jiawei.cui.12" title="jiawei.cui.12 on Facebook" target="_blank">
                  <i class="icon icon-social-facebook"></i>
                  <span class="label">Facebook</span>
                </a>
              </li>
            

            

            
              <!-- GitHub -->
              <li class="navigation__item">
                <a href="https://www.github.com/jiawei1996" title="jiawei1996 on GitHub" target="_blank">
                  <i class="icon icon-social-github"></i>
                  <span class="label">GitHub</span>
                </a>
              </li>
            

            
              <!-- Email -->
              <li class="navigation__item">
                <a href="mailto:cuijiawei.cn@gmail.com" title="Email cuijiawei.cn@gmail.com" target="_blank">
                  <i class="icon icon-mail"></i>
                  <span class="label">Email</span>
                </a>
              </li>
            

            <!-- RSS -->
            <li class="navigation__item">
              <a href="/feed.xml" title="Subscribe" target="_blank">
                <i class="icon icon-rss"></i>
                <span class="label">RSS</span>
              </a>
            </li>
          
            </ul>
          </nav>

        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>


    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="16 Mar 2017" class="post-meta__date date">16 Mar 2017</time> &#8226; <span class="post-meta__tags">on <a href="/tags/#Computer_Science">Computer_Science</a> </span>
    </div>
    <h1 class="post-title">Learning Advanced Javascript</h1>
  </header>

  <section class="post">
    <p><strong>#2: Goal: To be able to understand this function:</strong></p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre><span class="c1">// The .bind method from Prototype.js </span>
<span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">bind</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span> 
  <span class="kd">var</span> <span class="nx">fn</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">),</span> <span class="nx">object</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span> 
  <span class="k">return</span> <span class="kd">function</span><span class="p">(){</span> 
    <span class="k">return</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> 
      <span class="nx">args</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span> 
  <span class="p">};</span> 
<span class="p">};</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>要理解这段代码，首先要了解<em>javascript</em>的数组如下基本操作。</p>

<ul>
  <li>slice() 操作截取数组的一段， slice(start,end)则表示截取数组的start到end的一段，默认时为数组从头到尾。</li>
  <li>shift()返回数组的第一个元素并删除。</li>
  <li>concat()数组拼接</li>
</ul>

<p>涉及到一点函数知识，比如call与apply的区别。其实，call与apply的作用没有区别，都是给函数绑定对象，只不过call传递的是参数，apply传递的是数组。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="nx">func</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">);</span>
<span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">])</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>到此时，这段代码就可以基本读懂了。arguments不是数组，将其变成数组用了一步巧妙的<code class="highlighter-rouge">args = Array.prototype.slice.call(arguments)</code>因为arguments不是array，所以原本没有slice方法，不过Array.prototype有。随后用call将其绑定于arguments。</p>

<p>到后面有一步concat，是把bind()可能带有的参数加进去，这段代码也就解释清楚了。</p>

<p><strong>#11 the name of a function–匿名函数</strong></p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">ninja</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">myNinja</span><span class="p">(){</span> 
  <span class="nx">assert</span><span class="p">(</span> <span class="nx">ninja</span> <span class="o">==</span> <span class="nx">myNinja</span><span class="p">,</span> <span class="s2">"This function is named two things - at once!"</span> <span class="p">);</span> 
<span class="p">};</span> 
<span class="nx">ninja</span><span class="p">();</span> 
<span class="nx">assert</span><span class="p">(</span> <span class="k">typeof</span> <span class="nx">myNinja</span> <span class="o">==</span> <span class="s2">"undefined"</span><span class="p">,</span> <span class="s2">"But myNinja isn't defined outside of the function."</span> <span class="p">);</span> 
<span class="nx">log</span><span class="p">(</span> <span class="nx">ninja</span> <span class="p">);</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>这段代码的输出结果为</p>

<div class="highlighter-rouge"><pre class="highlight"><code>PASS This function is named two things - at once!
PASS But myNinja isn't defined outside of the function.
LOG function myNinja(){ assert( ninja == myNinja, "This function is named two things - at once!" ); }
</code></pre>
</div>

<p>说明匿名函数在函数外可以看作undefined，而实名函数则不会。</p>

<p><strong>#12: We can even do it if we’re an anonymous function that’s an object property.</strong></p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">ninja</span> <span class="o">=</span> <span class="p">{</span> 
  <span class="na">yell</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">){</span> 
    <span class="k">return</span> <span class="nx">n</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">?</span> <span class="nx">ninja</span><span class="p">.</span><span class="nx">yell</span><span class="p">(</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"a"</span> <span class="p">:</span> <span class="s2">"hiy"</span><span class="p">;</span> 
  <span class="p">}</span> 
<span class="p">};</span> 
<span class="nx">assert</span><span class="p">(</span> <span class="nx">ninja</span><span class="p">.</span><span class="nx">yell</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"hiyaaaa"</span><span class="p">,</span> <span class="s2">"A single object isn't too bad, either."</span> <span class="p">);</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>根据输出我们发现ninja.yell虽然定义在对象ninja内，仍然可以在对象外部调用它。</p>

<p><strong>#13: But what happens when we remove the original object?</strong></p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">ninja</span> <span class="o">=</span> <span class="p">{</span> 
  <span class="na">yell</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">){</span> 
    <span class="k">return</span> <span class="nx">n</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">?</span> <span class="nx">ninja</span><span class="p">.</span><span class="nx">yell</span><span class="p">(</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"a"</span> <span class="p">:</span> <span class="s2">"hiy"</span><span class="p">;</span> 
  <span class="p">}</span> 
<span class="p">};</span> 
<span class="nx">assert</span><span class="p">(</span> <span class="nx">ninja</span><span class="p">.</span><span class="nx">yell</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"hiyaaaa"</span><span class="p">,</span> <span class="s2">"A single object isn't too bad, either."</span> <span class="p">);</span> 

<span class="kd">var</span> <span class="nx">samurai</span> <span class="o">=</span> <span class="p">{</span> <span class="na">yell</span><span class="p">:</span> <span class="nx">ninja</span><span class="p">.</span><span class="nx">yell</span> <span class="p">};</span> 
<span class="kd">var</span> <span class="nx">ninja</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span> 

<span class="k">try</span> <span class="p">{</span> 
  <span class="nx">samurai</span><span class="p">.</span><span class="nx">yell</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> 
<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span> 
  <span class="nx">assert</span><span class="p">(</span> <span class="kc">false</span><span class="p">,</span> <span class="s2">"Uh, this isn't good! Where'd ninja.yell go?"</span> <span class="p">);</span> 
<span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>通过输出结果</p>

<div class="highlighter-rouge"><pre class="highlight"><code>PASS A single object isn't too bad, either.
FAIL Uh, this isn't good! Where'd ninja.yell go?
</code></pre>
</div>

<p>发现原来对象的赋值实际上是指针，指向了原来的对象，所以在删除了原来对象的时候，没有办法调用到这个函数。</p>

<p><strong>#14: Let’s give the anonymous function a name!</strong></p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">ninja</span> <span class="o">=</span> <span class="p">{</span> 
  <span class="na">yell</span><span class="p">:</span> <span class="kd">function</span> <span class="nx">yell</span><span class="p">(</span><span class="nx">n</span><span class="p">){</span> 
    <span class="k">return</span> <span class="nx">n</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">?</span> <span class="nx">yell</span><span class="p">(</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"a"</span> <span class="p">:</span> <span class="s2">"hiy"</span><span class="p">;</span> 
  <span class="p">}</span> 
<span class="p">};</span> 
<span class="nx">assert</span><span class="p">(</span> <span class="nx">ninja</span><span class="p">.</span><span class="nx">yell</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"hiyaaaa"</span><span class="p">,</span> <span class="s2">"Works as we would expect it to!"</span> <span class="p">);</span> 

<span class="kd">var</span> <span class="nx">samurai</span> <span class="o">=</span> <span class="p">{</span> <span class="na">yell</span><span class="p">:</span> <span class="nx">ninja</span><span class="p">.</span><span class="nx">yell</span> <span class="p">};</span> 
<span class="kd">var</span> <span class="nx">ninja</span> <span class="o">=</span> <span class="p">{};</span> 
<span class="nx">assert</span><span class="p">(</span> <span class="nx">samurai</span><span class="p">.</span><span class="nx">yell</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"hiyaaaa"</span><span class="p">,</span> <span class="s2">"The method correctly calls itself."</span> <span class="p">);</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>通过比较之前的代码，我们发现如果不给匿名函数命名，我们即便是在函数里调用这个函数也要用对象的方法<code class="highlighter-rouge">ninja.yell(n-1)</code>，命名之后我们就可以直接通过<code class="highlighter-rouge">yell(n-1)</code>来直接调用了。如果我们不想给它命名，也可以通过<code class="highlighter-rouge">arguments.callee(n-1)</code>来调用。</p>

<p><strong>#19: Is it possible to cache the return results from a function?</strong></p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre></td><td class="code"><pre><span class="kd">function</span> <span class="nx">getElements</span><span class="p">(</span> <span class="nx">name</span> <span class="p">)</span> <span class="p">{</span> 
  <span class="kd">var</span> <span class="nx">results</span><span class="p">;</span> 

  <span class="k">if</span> <span class="p">(</span> <span class="nx">getElements</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="p">)</span> <span class="p">{</span> 
    <span class="nx">results</span> <span class="o">=</span> <span class="nx">getElements</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span> 
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> 
    <span class="nx">results</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span> 
    <span class="nx">getElements</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">results</span><span class="p">;</span> 
  <span class="p">}</span> 

  <span class="k">return</span> <span class="nx">results</span><span class="p">;</span> 
<span class="p">}</span> 
<span class="nx">getElements</span><span class="p">.</span><span class="nx">cache</span> <span class="o">=</span> <span class="p">{};</span> 

<span class="nx">log</span><span class="p">(</span> <span class="s2">"Elements found: "</span><span class="p">,</span> <span class="nx">getElements</span><span class="p">(</span><span class="s2">"pre"</span><span class="p">).</span><span class="nx">length</span> <span class="p">);</span> 
<span class="nx">log</span><span class="p">(</span> <span class="s2">"Cache found: "</span><span class="p">,</span> <span class="nx">getElements</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">pre</span><span class="p">.</span><span class="nx">length</span> <span class="p">);</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>可以通过cache的方式将函数运行的结果存储起来。</p>

<p><strong>#20: QUIZ: Can you cache the results of this function?</strong></p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13</pre></td><td class="code"><pre><span class="kd">function</span> <span class="nx">isPrime</span><span class="p">(</span> <span class="nx">num</span> <span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">prime</span> <span class="o">=</span> <span class="nx">num</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// Everything but 1 can be prime</span>
  <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">num</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">num</span> <span class="o">%</span> <span class="nx">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">prime</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">prime</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">assert</span><span class="p">(</span> <span class="nx">isPrime</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="s2">"Make sure the function works, 5 is prime."</span> <span class="p">);</span>
<span class="nx">assert</span><span class="p">(</span> <span class="nx">isPrime</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="s2">"Is the answer cached?"</span> <span class="p">);</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>首先，看一道前端面试题目</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="p">{</span><span class="na">n</span><span class="p">:</span><span class="mi">1</span><span class="p">};</span>  
<span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span> <span class="c1">// 持有a，以回查  </span>
<span class="nx">a</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">a</span> <span class="o">=</span> <span class="p">{</span><span class="na">n</span><span class="p">:</span><span class="mi">2</span><span class="p">};</span>  
<span class="nx">alert</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span><span class="c1">// --&gt; undefined  </span>
<span class="nx">alert</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span><span class="c1">// --&gt; {n:2}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>它的结果为什么是这样。</p>

<p>对于这个问题，segmentfault上面一位用户给出了详尽的解答</p>

<blockquote>
  <p>同意3楼和4楼同学说的。连等是先确定<strong>所有</strong>变量的指针，再让指针指向那个赋值（<code class="highlighter-rouge"><span class="p">{</span><span class="err">n:3</span><span class="p">}</span></code>)。</p>

  <p>对于 <code class="highlighter-rouge">a.x = a = {n:2}</code>，楼主原先的思路应该是：</p>

  <ol>
    <li>先把 <code class="highlighter-rouge"><span class="p">{</span><span class="err">n:2</span><span class="p">}</span></code> 赋值给 a</li>
    <li>然后再创建 a.x，将 <code class="highlighter-rouge"><span class="p">{</span><span class="err">n:2</span><span class="p">}</span></code> 再赋值给 a.x</li>
  </ol>

  <p>这样似乎确实说不通 a.x 的值是 undefined，因为 a.x 确实是被赋值了的啊。 可是事实上，a.x 的值却是 undefined。</p>

  <p>再来看一下这个： <code class="highlighter-rouge">a = a.x = {n:2}</code>的话，按楼主原先的思路应该是：</p>

  <ol>
    <li>先把 <code class="highlighter-rouge"><span class="p">{</span><span class="err">n:2</span><span class="p">}</span></code> 赋值给 a.x，那么也就相当于 <code class="highlighter-rouge">b.x = {n:2}</code> 啦</li>
    <li>再把 a 重新指向 <code class="highlighter-rouge"><span class="p">{</span><span class="err">n:2</span><span class="p">}</span></code>。那么这是后 a.x 的值确实是 undefined，a 对象 <code class="highlighter-rouge"><span class="p">{</span><span class="err">n:2</span><span class="p">}</span></code> 中就没有 x 属性嘛。</li>
  </ol>

  <p>按楼主的思路，上述两种方式的结果应该是不同的。但事实却是<code class="highlighter-rouge">a = a.x = {n:2}</code>和<code class="highlighter-rouge">a.x = a = {n:2}</code>的结果是一致的。所以楼主的那种赋值的思路是不对的。</p>

  <p>事实上，解析器在接受到 <code class="highlighter-rouge">a = a.x = {n:2}</code> 这样的语句后，会这样做：</p>

  <ol>
    <li>找到 a 和 a.x 的指针。如果已有指针，那么不改变它。如果没有指针，即那个变量还没被申明，那么就创建它，指向 null。
a 是有指针的，指向 <code class="highlighter-rouge"><span class="p">{</span><span class="err">n:1</span><span class="p">}</span></code>；a.x 是没有指针的，所以创建它，指向 null。</li>
    <li>然后把上面找到的指针，都指向最右侧赋的那个值，即 <code class="highlighter-rouge"><span class="p">{</span><span class="err">n:2</span><span class="p">}</span></code>。</li>
  </ol>

  <p>所以执行以后，就有了如下的变量关系图。楼主可以慢慢体会下，想通了就很简单的。</p>
</blockquote>

<p><img src="https://segmentfault.com/img/bVleKD" alt="image" /></p>

<p>其实这道题目并不需要这些知识就可以解决，我们只是借用它去理解prime = num != 1来判断当num == 1时的prime值。</p>

<p>正确答案如下：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20</pre></td><td class="code"><pre><span class="kd">function</span> <span class="nx">isPrime</span><span class="p">(</span> <span class="nx">num</span> <span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">isPrime</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">num</span><span class="p">])</span> <span class="k">return</span> <span class="nx">isPrime</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">num</span><span class="p">];</span>
  <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">prime</span> <span class="o">=</span> <span class="nx">num</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// Everything but 1 can be prime</span>
      <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">num</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nx">num</span> <span class="o">%</span> <span class="nx">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">prime</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">isPrime</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">num</span><span class="p">]</span> <span class="o">=</span> <span class="nx">prime</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">prime</span><span class="p">;</span>   
  <span class="p">}</span>

<span class="p">}</span>

<span class="nx">isPrime</span><span class="p">.</span><span class="nx">cache</span> <span class="o">=</span> <span class="p">{};</span>

<span class="nx">assert</span><span class="p">(</span> <span class="nx">isPrime</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="s2">"Make sure the function works, 5 is prime."</span> <span class="p">);</span>
<span class="nx">assert</span><span class="p">(</span> <span class="nx">isPrime</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="s2">"Is the answer cached?"</span> <span class="p">);</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p><strong>#27: QUIZ: How can we implement looping with a callback?</strong></p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre><span class="kd">function</span> <span class="nx">loop</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">fn</span><span class="p">){</span>
  <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Implement me!</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nx">loop</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">){</span>
  <span class="nx">assert</span><span class="p">(</span><span class="nx">value</span> <span class="o">==</span> <span class="nx">num</span><span class="o">++</span><span class="p">,</span> <span class="s2">"Make sure the contents are as we expect it."</span><span class="p">);</span>
  <span class="nx">assert</span><span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nb">Array</span><span class="p">,</span> <span class="s2">"The context should be the full array."</span><span class="p">);</span>
<span class="p">});</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>一开到这个问题还有点头晕，不过想到是context里面的题目，于是想到solution</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre><span class="kd">function</span> <span class="nx">loop</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">fn</span><span class="p">){</span>
  <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span>
    <span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span> <span class="nx">array</span><span class="p">,</span> <span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">i</span> <span class="p">);</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nx">loop</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">i</span><span class="p">){</span>
  <span class="nx">assert</span><span class="p">(</span><span class="nx">value</span> <span class="o">==</span> <span class="nx">num</span><span class="o">++</span><span class="p">,</span> <span class="s2">"Make sure the contents are as we expect it."</span><span class="p">);</span>
  <span class="nx">assert</span><span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nb">Array</span><span class="p">,</span> <span class="s2">"The context should be the full array."</span><span class="p">);</span>
<span class="p">});</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>本页为原创内容，转载请注明出处http://localhost:4000//2017/Learning-Advanced-Javascript/
</code></pre>
</div>


  </section>
  
</article>



      </div>

      <footer class="footer">
  <span class="footer__copyright">&copy; 2017 崔家维. All rights reserved.</span>
</footer> 

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>

    </div>
  </body>
</html>